<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tuff? — Nexus Terminal</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#000; --fg:#33ff33; --muted:#1e1e1e; --dim:#1a8a1a; --accent:#66ff66; --error:#ff5555;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    background:var(--bg);
    color:var(--fg);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    margin:0; display:flex; align-items:center; justify-content:center; padding:10px; overflow:hidden;
  }
  #terminal{
    background: #000;
    border: 2px solid var(--fg);
    width: 92vw; max-width: 960px; height: 70vh; max-height: 620px;
    padding: 12px; overflow: auto; white-space: pre-wrap; line-height:1.35;
    scrollbar-width: none; -ms-overflow-style: none; scrollbar-color: transparent transparent;
    box-shadow: 0 0 0 3px #003300 inset, 0 0 25px #001800;
  }
  #terminal::-webkit-scrollbar{width:0;height:0}
  .row{display:block}
  .dim{color:var(--dim)}
  .bright{color:var(--accent); font-weight:600}
  .error{color:var(--error)}
  .prompt{color:var(--fg)}
  code,kbd{background:transparent; border:1px solid var(--dim); padding:0 .2rem; border-radius:4px}
  #input-line{display:inline}
  #cursor{display:inline; animation: blink 1s step-start infinite;}
  @keyframes blink{50%{opacity:0}}
  .invert{filter:brightness(1.2)}
  .hr{border-bottom:1px dotted var(--dim); margin:.25rem 0}
  .table{font-variant-numeric: tabular-nums;}
  .click-focus{outline:none}
</style>
</head>
<body>
  <div id="terminal" tabindex="0" class="click-focus" aria-label="Nexus Terminal">
    <div id="boot"></div>
    <div id="output"></div>
    <div id="input-wrapper"><span id="prompt" class="prompt"></span><div id="input-line"><span id="input"></span><span id="cursor">█</span></div></div>
  </div>

<script>
/* ========= CORE ELEMENTS ========= */
const term = document.getElementById("terminal");
const boot = document.getElementById("boot");
const output = document.getElementById("output");
const input = document.getElementById("input");
const promptSpan = document.getElementById("prompt");
const inputWrapper = document.getElementById("input-wrapper");

let command = "";
let running = false;
let frames = [];
let frameTimer = null;
let lastDynamicBlock = null;
let activeKeyHandler = null;
let history = JSON.parse(localStorage.getItem("nx_history") || "[]");
let histIndex = history.length;
const commandsList = new Set(); // filled later for tab completion

/* ========= SYSTEM INFO / PROMPT ========= */
const sys = {
  user: localStorage.getItem("nx_user") || "nexus",
  host: localStorage.getItem("nx_host") || "local",
  kernel: "5.15.2-nx",
  os: "NexusOS 1.0",
  shell: "bash 5.1",
  boot: new Date()
};

function getPwd(){ return "/" + cwd.join("/"); }
function setPrompt(){
  promptSpan.textContent = `${sys.user}@${sys.host}:${getPwd()} $ `;
}
let cwd = ["home","nexus"];

/* ========= RENDER HELPERS ========= */
function scrollToBottom(){ term.scrollTop = term.scrollHeight; }
function line(text=""){ const div = document.createElement("div"); div.className="row"; div.textContent = text; output.appendChild(div); scrollToBottom(); return div; }
function lineHTML(html=""){ const div = document.createElement("div"); div.className="row"; div.innerHTML = html; output.appendChild(div); scrollToBottom(); return div; }
function hr(){ const d=document.createElement("div"); d.className="hr"; output.appendChild(d); scrollToBottom(); }
function printPrompted(cmd){ line(`${promptSpan.textContent}${cmd}`); }

/* ========= BOOT BANNER ========= */
(function bootBanner(){
  const last = localStorage.getItem("nx_last_login");
  const now = new Date();
  const banner = [
    `Nexus Terminal ${sys.os} (${sys.kernel})`,
    last ? `Last login: ${last}` : "First login: welcome!",
    `Type ${"help"} for commands. Press Ctrl+C to stop running programs.`
  ].join("\n");
  boot.textContent = banner + "\n";
  localStorage.setItem("nx_last_login", now.toString());
})();

/* ========= ANSI-ish helpers ========= */
const c = {
  dim: s => `<span class="dim">${s}</span>`,
  bright: s => `<span class="bright">${s}</span>`,
  err: s => `<span class="error">${s}</span>`
};

/* ========= FRAMES (parrot) ========= */
async function loadFrames(){
  if(frames.length) return;
  const reqs = [];
  for(let i=0;i<10;i++) reqs.push(fetch(`./frames/${i}.txt`).then(r=>r.text()));
  frames = await Promise.all(reqs);
}

/* ========= FAKE FILESYSTEM ========= */
const fs = {
  home: { nexus: {
    "readme.txt": "Welcome to the Nexus Terminal.\nType `help` to see available commands.",
    "todo.txt": "- Build cool stuff\n- Watch the parrot\n- Not get caught by sudo",
  }},
  etc: { motd: "Beware of party parrots." },
  var: { log: { syslog: "[OK] Boot complete.\n[WARN] Parrot consuming 70% dance power." } }
};

function isDir(node){ return node && typeof node === "object" && !Array.isArray(node); }
function resolvePath(p){
  if(!p || p === ".") return [...cwd];
  let parts = p.startsWith("/") ? p.split("/").slice(1) : [...cwd, ...p.split("/")];
  const stack = [];
  for(const seg of parts){
    if(!seg || seg === ".") continue;
    if(seg === "..") { if(stack.length) stack.pop(); continue; }
    stack.push(seg);
  }
  return stack;
}
function getNode(pathArr){
  let cur = fs;
  for(const seg of pathArr){
    if(!isDir(cur)) return undefined;
    cur = cur[seg];
    if(cur === undefined) return undefined;
  }
  return cur;
}
function ensureParent(pathArr){
  const parent = pathArr.slice(0,-1);
  const name = pathArr[pathArr.length-1];
  const node = getNode(parent);
  return { parent: node, name };
}

/* ========= BUILT-IN COMMANDS ========= */
async function cmd_parrot(){
  await loadFrames();
  line("Starting parrot... (Ctrl+C to stop)");
  running = true;
  lastDynamicBlock = line(); // empty placeholder
  let i=0;
  frameTimer = setInterval(()=>{ if(lastDynamicBlock) lastDynamicBlock.textContent = frames[i++%frames.length]; scrollToBottom(); }, 70);
  activeKeyHandler = (ev)=>{
    if(ev.ctrlKey && ev.key.toLowerCase()==="c"){ stopDynamic("Process interrupted."); }
    if(ev.key==="Enter"){ stopDynamic("Process stopped."); }
  };
}
function stopDynamic(msg){
  if(frameTimer){ clearInterval(frameTimer); frameTimer=null; }
  running=false; activeKeyHandler=null; if(lastDynamicBlock) lastDynamicBlock=null;
  if(msg) line(msg);
}

async function cmd_npm_install(){
  running = true;
  const block = line();
  const total=20;
  for(let i=0;i<=total;i++){
    const pct = Math.floor(i/total*100);
    const bars = "=".repeat(Math.floor(i/total*20)).padEnd(20," ");
    block.textContent = `Downloading [${bars}] ${pct}%`;
    await new Promise(r=>setTimeout(r,120));
  }
  line("Extracting..."); await wait(300);
  line("Linking dependencies..."); await wait(250);
  line("Building modules..."); await wait(300);
  line("Done. Installed 204 packages.");
  running=false;
}
function wait(ms){ return new Promise(r=>setTimeout(r,ms)); }

function isValidHostname(hostname){
  const re=/^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(\.[A-Za-z0-9-]{2,63})+$/;
  return re.test(hostname);
}
async function cmd_ping(host){
  if(!host){ line("ping: usage error: Destination address required"); return; }
  if(!isValidHostname(host)){ line(`ping: cannot resolve ${host}: Unknown host`); return; }
  const fakeIP="172.217.169.46";
  line(`Pinging ${host} [${fakeIP}] with 32 bytes of data:`);
  for(let i=0;i<4;i++){
    const time=9+Math.floor(Math.random()*3);
    line(`Reply from ${fakeIP}: bytes=32 time=${time}ms TTL=116`);
    await wait(400);
  }
  line(""); line(`Ping statistics for ${fakeIP}:`);
  line("    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),");
  line("Approximate round trip times in milli-seconds:");
  line("    Minimum = 9ms, Maximum = 11ms, Average = 10ms");
}

/* ========= UTILS / UNIXY ========= */
function cmd_help(){
  const help = `
Available commands:
  help                 Show this help
  clear                Clear the terminal
  exit                 Return to homepage
  history              Show command history
  whoami               Print current user
  hostname             Print host name
  pwd                  Print working directory
  ls [-l] [path]       List files
  cd [path]            Change directory
  cat <file>           Show file contents
  touch <file>         Create file
  mkdir <dir>          Create directory
  rm [-r] <path>       Remove file/dir
  echo TEXT            Print TEXT
  echo TEXT > file     Write to file (>> appends)
  date                 Show date/time
  uptime               Show system uptime
  neofetch             Show system info (ASCII)
  top                  Show live process table (q to quit)
  fortune              Print a random fortune
  man <cmd>            Brief manual for command

Network & fun:
  ping <host>          Simulated ping
  curl parrot.live     Party parrot animation (Ctrl+C to stop)
  npm / npm install    Simulated npm usage/install
  reset_data           Clear cookies/localStorage/sessionStorage`;
  line(help.trim());
}
function cmd_whoami(){ line(sys.user); }
function cmd_hostname(){ line(sys.host); }
function cmd_pwd(){ line("/"+cwd.join("/")); }
function cmd_ls(args){
  const long = args.includes("-l");
  const p = args.find(a=>!a.startsWith("-"));
  const pathArr = resolvePath(p||".");
  const node = getNode(pathArr);
  if(node===undefined) { line(`ls: cannot access '${p}': No such file or directory`); return; }
  if(!isDir(node)) { line(p||Object.keys(node).join("  ")); return; }
  const names = Object.keys(node).sort();
  if(!long){ line(names.join("  ")); return; }
  const rows = names.map(n=>{
    const child=node[n];
    const isD = isDir(child);
    const perms = isD?"drwxr-xr-x":"-rw-r--r--";
    const size = isD?4096: (typeof child==="string"?child.length:512);
    return `${perms} 1 ${sys.user} ${sys.user} ${size.toString().padStart(6)} ${new Date().toDateString()} ${n}${isD?"/":""}`;
  }).join("\n");
  line(rows);
}
function cmd_cd(path){
  const dest = resolvePath(path||"/home/nexus");
  const node = getNode(dest);
  if(node===undefined || !isDir(node)){ line(`cd: ${path||""}: No such directory`); return; }
  cwd = dest; setPrompt();
}
function cmd_cat(file){
  if(!file){ line("cat: missing file operand"); return; }
  const p = resolvePath(file);
  const node = getNode(p);
  if(node===undefined){ line(`cat: ${file}: No such file`); return; }
  if(isDir(node)){ line(`cat: ${file}: Is a directory`); return; }
  line(node);
}
function cmd_touch(file){
  if(!file){ line("touch: missing file operand"); return; }
  const p=resolvePath(file);
  const {parent,name}=ensureParent(p);
  if(parent===undefined || !isDir(parent)){ line(`touch: cannot touch '${file}': No such directory`); return; }
  if(parent[name]===undefined) parent[name]="";
}
function cmd_mkdir(dir){
  if(!dir){ line("mkdir: missing operand"); return; }
  const p=resolvePath(dir);
  const {parent,name}=ensureParent(p);
  if(!isDir(parent)){ line(`mkdir: cannot create directory '${dir}': No such file or directory`); return; }
  if(parent[name]!==undefined){ line(`mkdir: cannot create directory '${dir}': File exists`); return; }
  parent[name]={};
}
function removeNodeAt(pathArr){
  const {parent,name}=ensureParent(pathArr);
  if(!isDir(parent) || !(name in parent)) return false;
  delete parent[name]; return true;
}
function cmd_rm(args){
  const recursive = args.includes("-r");
  const target = args.find(a=>!a.startsWith("-"));
  if(!target){ line("rm: missing operand"); return; }
  const p = resolvePath(target);
  const node = getNode(p);
  if(node===undefined){ line(`rm: cannot remove '${target}': No such file or directory`); return; }
  if(isDir(node) && !recursive){ line(`rm: cannot remove '${target}': Is a directory`); return; }
  removeNodeAt(p);
}
function cmd_echo(args){
  // support echo TEXT > file  / >>
  const txt = args.join(" ");
  const redir = txt.match(/^(.*)\s(>>|>)\s(.+)$/);
  if(!redir){ line(txt); return; }
  const body = redir[1];
  const mode = redir[2];
  const target = redir[3];
  const p = resolvePath(target);
  const {parent,name}=ensureParent(p);
  if(!isDir(parent)){ line(`echo: ${target}: No such directory`); return; }
  if(parent[name]===undefined) parent[name]="";
  if(typeof parent[name] !== "string"){ line(`echo: ${target}: Is a directory`); return; }
  parent[name] = mode===">>" ? (parent[name]+(parent[name]&&"\n")+body) : body;
}
function cmd_date(){ line(new Date().toString()); }
function cmd_uptime(){
  const ms = Date.now() - sys.boot.getTime();
  const mins = Math.floor(ms/60000)%60;
  const hrs  = Math.floor(ms/3600000)%24;
  const days = Math.floor(ms/86400000);
  line(`up ${days} day(s), ${hrs} hour(s), ${mins} min(s)`);
}
function cmd_neofetch(){
  lineHTML(`
${c.bright("      .---.")}   ${sys.user}@${sys.host}
${c.bright("     /     \\\\")}  OS: ${sys.os}
${c.bright("    |  o_o  |")}  Kernel: ${sys.kernel}
${c.bright("    \\  \\_/  /")}  Uptime: see 'uptime'
${c.bright("     \\     /")}  Shell: ${sys.shell}
      '---'     Theme: Retro Green
`);
}
function cmd_history(){
  const start = Math.max(0, history.length - 200);
  history.slice(start).forEach((h,i)=>line(`${start+i+1}  ${h}`));
}
function cmd_man(cmd){
  const docs = {
    help:"help - list available commands.\nUsage: help",
    ls:"ls - list directory contents.\nUsage: ls [-l] [path]",
    cd:"cd - change directory.\nUsage: cd [path]",
    cat:"cat - concatenate file and print.\nUsage: cat <file>",
    touch:"touch - create an empty file.\nUsage: touch <file>",
    mkdir:"mkdir - make directories.\nUsage: mkdir <dir>",
    rm:"rm - remove files or directories.\nUsage: rm [-r] <path>",
    echo:"echo - display line of text, supports > and >> redirection.\nUsage: echo TEXT [> file|>> file]",
    top:"top - display live processes (simulated). Press q to quit.",
    fortune:"fortune - print a random saying.",
    ping:"ping - send ICMP echo requests (simulated).\nUsage: ping <host>",
    "curl parrot.live":"curl parrot.live - summon the party parrot.",
    npm:"npm - JavaScript package manager (simulated).",
    reset_data:"reset_data - clear cookies/localStorage/sessionStorage."
  };
  line(docs[cmd] || `No manual entry for ${cmd}`);
}
function cmd_fortune(){
  const fortunes = [
    "You will find a bug... and fix it.",
    "rm -rf / is not the answer.",
    "Parrot approves your work.",
    "Code is poetry.",
    "Keep it simple; then ship it."
  ];
  line(fortunes[Math.floor(Math.random()*fortunes.length)]);
}
function cmd_top(){
  running = true;
  lastDynamicBlock = line(); // container
  function gen(){
    const rows = [];
    rows.push("top - NexusOS monitor   (press q to quit)");
    rows.push("PID   USER     CPU%  MEM%  COMMAND");
    for(let i=0;i<8;i++){
      const pid = (1000+Math.floor(Math.random()*8000)).toString().padEnd(5);
      const user = sys.user.padEnd(8);
      const cpu = (Math.random()*50).toFixed(1).toString().padStart(4);
      const mem = (Math.random()*20).toFixed(1).toString().padStart(4);
      const cmd = ["parrot","node","uv","bash","ping","sleep","games.js","proxy"][Math.floor(Math.random()*8)];
      rows.push(`${pid} ${user}  ${cpu}   ${mem}  ${cmd}`);
    }
    return rows.join("\n");
  }
  lastDynamicBlock.textContent = gen();
  frameTimer = setInterval(()=>{ if(lastDynamicBlock) lastDynamicBlock.textContent = gen(); }, 600);
  activeKeyHandler = (ev)=>{ if(ev.key.toLowerCase()==="q" || (ev.ctrlKey && ev.key.toLowerCase()==="c")) stopDynamic("top terminated."); };
}

/* ========= ORIGINAL SPECIALS KEPT ========= */
async function runParrot(){ await cmd_parrot(); }
async function runNpmInstall(){ await cmd_npm_install(); }
async function pingHost(host){ await cmd_ping(host); }
function clearData(){
  // cookies
  document.cookie.split(";").forEach(cookie=>{
    const eq=cookie.indexOf("="); const name=(eq>-1?cookie.substr(0,eq):cookie).trim();
    if(name) document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
  });
  localStorage.clear(); sessionStorage.clear();
}

/* ========= INPUT HANDLING ========= */
function submitCommand(raw){
  printPrompted(raw);
  if(!raw.trim()) return;
  history.push(raw); localStorage.setItem("nx_history", JSON.stringify(history)); histIndex = history.length;

  const {cmd, args} = parseCommand(raw);

  // npm / special multi-line messages preserved from your original:
  if(cmd === "npm"){
    setTimeout(()=>{
      line(`Usage:

npm install        install all the dependencies in your project
npm install <foo>  add the <foo> dependency to your project
npm test           run this project's tests
npm run <foo>      run the script named <foo>
npm <command> -h   quick help on <command>
npm -l             display usage info for all commands
npm help <term>    search for help on <term> (in a browser)
npm help npm       more involved overview (in a browser)

All commands:

    access, adduser, audit, bugs, cache, ci, completion,
    config, dedupe, deprecate, diff, dist-tag, docs, doctor,
    edit, exec, explain, explore, find-dupes, fund, get, help,
    help-search, init, install, install-ci-test, install-test,
    link, ll, login, logout, ls, org, outdated, owner, pack,
    ping, pkg, prefix, profile, prune, publish, query, rebuild,
    repo, restart, root, run, sbom, search, set, shrinkwrap,
    star, stars, start, stop, team, test, token, undeprecate,
    uninstall, unpublish, unstar, update, version, view, whoami

Specify configs in the ini-formatted file:
    \\Netlify\\Storage\\npm\\.npmrc 
or on the command line via: npm <command> --key=value

More configuration info: npm help config
Configuration fields: npm help 7 config

npm@11.4.2 \\Netlify\\Storage\\npm\\node_modules\\npm`);
    }, 300);
    return;
  }
  if(cmd==="npm" && args[0]==="help" && args[1]==="npm"){ window.open("npm.html","_blank"); return; }

  // map commands
  const table = {
    help: ()=>cmd_help(),
    clear: ()=>{ output.innerHTML=""; },
    exit: ()=>{ line("Exiting terminal..."); setTimeout(()=>{ if (window.top !== window.self) window.top.location.href="/"; else window.location.href="/"; }, 600); },
    echo: ()=>cmd_echo(args),
    date: ()=>cmd_date(),
    uptime: ()=>cmd_uptime(),
    whoami: ()=>cmd_whoami(),
    hostname: ()=>cmd_hostname(),
    pwd: ()=>cmd_pwd(),
    ls: ()=>cmd_ls(args),
    cd: ()=>cmd_cd(args[0]),
    cat: ()=>cmd_cat(args[0]),
    touch: ()=>cmd_touch(args[0]),
    mkdir: ()=>cmd_mkdir(args[0]),
    rm: ()=>cmd_rm(args),
    history: ()=>cmd_history(),
    neofetch: ()=>cmd_neofetch(),
    top: ()=>cmd_top(),
    fortune: ()=>cmd_fortune(),
    man: ()=>cmd_man(args[0]),
    ping: ()=>cmd_ping(args[0]),
    curl: ()=> (args.join(" ")==="parrot.live" ? cmd_parrot() : line(`curl: (6) Could not resolve host: ${args.join(" ")}`)),
    npm: ()=>{}, // handled above
    "npm install": ()=>cmd_npm_install(),
    "npm i": ()=>cmd_npm_install(),
    "npm test": ()=>{ running=true; line("Running tests..."); setTimeout(()=>{ line(`npm ERR! code ENOENT
npm ERR! syscall open
npm ERR! path \\Netlify\\package.json
npm ERR! errno -4058
npm ERR! enoent Could not read package.json: Error: ENOENT: no such file or directory, open '\\Netlify\\npm\\package.json' 
npm ERR! enoent This is related to npm not being able to find a file.
npm ERR! enoent
npm ERR! A complete log of this run can be found in:
npm ERR!     \\Netlify\\npm-cache\\_logs\\2025-07-07T02_35_54_854Z-debug-0.log`); running=false; }, 600); },
    reset_data: ()=>{ line("this will delete all your data (not a joke), are we sure gng 🥀 (y,n)"); running=true;
      const confirmReset=(e)=>{
        if(e.key.toLowerCase()==="y"){ line("Resetting data in 1 second..."); setTimeout(()=>{ clearData(); line("All data reset."); running=false; document.removeEventListener("keydown", confirmReset); }, 1000); }
        else if(e.key.toLowerCase()==="n"){ line("Cancelled."); running=false; document.removeEventListener("keydown", confirmReset); }
      };
      document.addEventListener("keydown", confirmReset);
    },
    sudo: ()=>lineHTML(c.err(`${sys.user} is not in the sudoers file. This incident will be reported.`)),
    git: ()=>line("fatal: not a git repository (or any of the parent directories): .git")
  };

  // dispatch
  if(table[cmd]) { table[cmd](); return; }
  // alias handling
  if(raw.trim()==="curl parrot.live"){ cmd_parrot(); return; }
  if(raw.trim()==="npm install"){ cmd_npm_install(); return; }
  if(raw.trim()==="npm i"){ cmd_npm_install(); return; }

  line(`bash: ${cmd.split(" ")[0]}: command not found`);
}

/* ========= COMMAND PARSING ========= */
function parseCommand(raw){
  // very small tokenizer: supports quotes for echo
  const tokens = [];
  let cur=""; let q=null;
  for(const ch of raw){
    if(q){
      if(ch===q){ q=null; }
      else { cur+=ch; }
    } else {
      if(ch==='"' || ch==="'") q=ch;
      else if(ch===" "){ if(cur){ tokens.push(cur); cur=""; } }
      else cur+=ch;
    }
  }
  if(cur) tokens.push(cur);
  // join for compound cmds like "npm install"
  const cmd = (tokens[0]==="npm" && tokens[1] && (tokens[1]==="install" || tokens[1]==="i" || tokens[1]==="test")) ? `${tokens[0]} ${tokens[1]}` : tokens[0] || "";
  const args = tokens.slice(cmd.split(" ").length);
  return { cmd, args };
}

/* ========= KEYBOARD ========= */
document.addEventListener("keydown", async (e)=>{
  if(activeKeyHandler){ activeKeyHandler(e); if(e.ctrlKey && e.key.toLowerCase()==="c") e.preventDefault(); }
  if(running) return;

  if(e.key==="Backspace"){
    command = command.slice(0,-1);
  } else if(e.key==="Enter"){
    const toRun = command;
    command = "";
    submitCommand(toRun);
  } else if(e.key==="ArrowUp"){
    if(histIndex>0){ histIndex--; command = history[histIndex] || ""; }
  } else if(e.key==="ArrowDown"){
    if(histIndex<history.length){ histIndex++; command = history[histIndex] || ""; }
  } else if(e.key==="Tab"){
    e.preventDefault();
    command = autocomplete(command);
  } else if(e.ctrlKey && e.key.toLowerCase()==="l"){ // Ctrl+L clear
    output.innerHTML=""; command="";
  } else if(e.ctrlKey || e.metaKey){
    // ignore other control chords
  } else if(e.key.length===1){
    command += e.key;
  }
  input.textContent = command;
  scrollToBottom();
});

/* ========= TAB COMPLETION ========= */
function buildCommandList(){
  ["help","clear","exit","history","whoami","hostname","pwd","ls","cd","cat","touch","mkdir","rm",
   "echo","date","uptime","neofetch","top","fortune","man","ping","curl","npm","reset_data","sudo","git"].forEach(c=>commandsList.add(c));
}
buildCommandList();

function autocomplete(current){
  const parts = current.split(" ");
  if(parts.length===1){
    const prefix = parts[0];
    const opts = [...commandsList].filter(c=>c.startsWith(prefix));
    if(opts.length===1) return opts[0]+" ";
    if(opts.length>1){ line(opts.join("  ")); return current; }
    return current;
  } else {
    const last = parts[parts.length-1];
    const base = parts.slice(0,-1).join(" ");
    const node = getNode(cwd);
    const names = Object.keys(node||{});
    const opts = names.filter(n=>n.startsWith(last));
    if(opts.length===1) return base+" "+opts[0];
    if(opts.length>1){ line(opts.join("  ")); }
    return current;
  }
}

/* ========= FOCUS & PROMPT ========= */
term.addEventListener("mousedown", ()=> term.focus());
setPrompt();
lineHTML(`${c.bright("Welcome to the Nexus Terminal!")} Type ${c.bright("help")} for a list of commands.`);

/* Keep prompt line always visible at the bottom */
const observer = new MutationObserver(()=>{ inputWrapper.scrollIntoView(false); });
observer.observe(output, {childList:true});

</script>
</body>
</html>
